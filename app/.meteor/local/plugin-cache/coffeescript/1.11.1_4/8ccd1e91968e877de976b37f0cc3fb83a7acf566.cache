{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar fallback_language;         \n\nfallback_language = globals.fallback_language;\n\nTAPi18n = function() {\n  EventEmitter.call(this);\n  this._fallback_language = fallback_language;\n  this._language_changed_tracker = new Tracker.Dependency;\n  this._loaded_languages = [fallback_language];\n  this.conf = null;\n  this.packages = {};\n  this.languages_names = {};\n  this.translations = {};\n  if (Meteor.isClient) {\n    Session.set(this._loaded_lang_session_key, null);\n    this._languageSpecificTranslators = {};\n    this._languageSpecificTranslatorsTrackers = {};\n  }\n  if (Meteor.isServer) {\n    this.server_translators = {};\n    Meteor.startup((function(_this) {\n      return function() {\n        if (_this._enabled()) {\n          return _this._registerHTTPMethod();\n        }\n      };\n    })(this));\n  }\n  this.__ = this._getPackageI18nextProxy(globals.project_translations_domain);\n  TAPi18next.setLng(fallback_language);\n  return this;\n};\n\nUtil.inherits(TAPi18n, EventEmitter);\n\n_.extend(TAPi18n.prototype, {\n  _loaded_lang_session_key: \"TAPi18n::loaded_lang\",\n  _enable: function(conf) {\n    this.conf = conf;\n    return this._onceEnabled();\n  },\n  _onceEnabled: function() {},\n  _enabled: function() {\n    return this.conf != null;\n  },\n  _getPackageDomain: function(package_name) {\n    return package_name.replace(/:/g, \"-\");\n  },\n  addResourceBundle: function(lang_tag, package_name, translations) {\n    return TAPi18next.addResourceBundle(lang_tag, this._getPackageDomain(package_name), translations);\n  },\n  _getSpecificLangTranslator: function(lang) {\n    var current_lang, translator;\n    current_lang = TAPi18next.lng();\n    translator = null;\n    TAPi18next.setLng(lang, {\n      fixLng: true\n    }, (function(_this) {\n      return function(lang_translator) {\n        return translator = lang_translator;\n      };\n    })(this));\n    TAPi18next.setLng(current_lang);\n    return translator;\n  },\n  _getProjectLanguages: function() {\n    if (this._enabled()) {\n      if (_.isArray(this.conf.supported_languages)) {\n        return _.union([this._fallback_language], this.conf.supported_languages);\n      } else {\n        return _.keys(this.languages_names);\n      }\n    } else {\n      return [this._fallback_language];\n    }\n  },\n  getLanguages: function() {\n    var i, lang_tag, languages, len, ref;\n    if (!this._enabled()) {\n      return null;\n    }\n    languages = {};\n    ref = this._getProjectLanguages();\n    for (i = 0, len = ref.length; i < len; i++) {\n      lang_tag = ref[i];\n      languages[lang_tag] = {\n        name: this.languages_names[lang_tag][1],\n        en: this.languages_names[lang_tag][0]\n      };\n    }\n    return languages;\n  },\n  _loadLangFileObject: function(language_tag, data) {\n    var package_keys, package_name, ref, results;\n    results = [];\n    for (package_name in data) {\n      package_keys = data[package_name];\n      package_keys = _.extend({}, package_keys, ((ref = this._loadTranslations_cache[language_tag]) != null ? ref[package_name] : void 0) || {});\n      results.push(this.addResourceBundle(language_tag, package_name, package_keys));\n    }\n    return results;\n  },\n  _loadTranslations_cache: {},\n  loadTranslations: function(translations, namespace) {\n    var language_tag, project_languages, results, translation_keys;\n    project_languages = this._getProjectLanguages();\n    results = [];\n    for (language_tag in translations) {\n      translation_keys = translations[language_tag];\n      if (this._loadTranslations_cache[language_tag] == null) {\n        this._loadTranslations_cache[language_tag] = {};\n      }\n      if (this._loadTranslations_cache[language_tag][namespace] == null) {\n        this._loadTranslations_cache[language_tag][namespace] = {};\n      }\n      _.extend(this._loadTranslations_cache[language_tag][namespace], translation_keys);\n      this.addResourceBundle(language_tag, namespace, translation_keys);\n      if (Meteor.isClient && this.getLanguage() === language_tag) {\n        results.push(this._language_changed_tracker.changed());\n      } else {\n        results.push(void 0);\n      }\n    }\n    return results;\n  }\n});\n","sourceMap":{"version":3,"file":"/lib/tap_i18n/tap_i18n-common.coffee.js","sourceRoot":"","sources":["/packages/tap_i18n/lib/tap_i18n/tap_i18n-common.coffee"],"names":[],"mappings":"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"}}